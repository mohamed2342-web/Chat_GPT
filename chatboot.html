<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مساعد المحادثة الذكي | AI Universe</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
  <style>
    body { background: #f8f9fa; font-family: 'Cairo', sans-serif;}
.section-title { color: #2c3e50; margin-top: 30px;}
.feature-icon { font-size: 2rem; color: #007bff; margin-left: 10px;}
.chat-box { background: #fff; border-radius: 10px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.07);}
.chat-input { border-radius: 20px; resize: none;}
.chat-log { margin-top: 20px;}
.chat-message,.chat-reply {
      padding: 10px 15px;
      border-radius: 15px;
      margin-bottom: 10px;
      white-space: pre-wrap;
}
.chat-message { background: #e9ecef;}
.chat-reply { background: #d1e7dd; text-align: right;}
    #loading { display: none;}
  </style>
</head>
<body>

  <!-- شريط التنقل -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container">
      <a class="navbar-brand" href="index.html">AI Universe</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="chatbot.html">المحادثة</a></li>
          <li class="nav-item"><a class="nav-link" href="textgen.html">توليد النصوص</a></li>
          <li class="nav-item"><a class="nav-link" href="imagegen.html">توليد الصور</a></li>
          <li class="nav-item"><a class="nav-link" href="translate.html">الترجمة</a></li>
          <li class="nav-item"><a class="nav-link" href="dataanalysis.html">تحليل البيانات</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h1 class="text-center mb-4 section-title"><i class="fa-solid fa-comments feature-icon"></i> مساعد المحادثة الذكي</h1>
    <p class="lead text-center mb-5">تواصل مع الذكاء الاصطناعي بشكل تفاعلي وسريع، واحصل على إجابات فورية ودعم في مختلف المجالات.</p>

    <div class="chat-box mx-auto" style="max-width:600px;">
      <div class="mb-3">
        <label for="userMessage" class="form-label">رسالتك:</label>
        <textarea id="userMessage" class="form-control chat-input" rows="2" placeholder="اكتب رسالتك هنا..."></textarea>
      </div>
      <div class="d-grid gap-2">
        <button id="sendBtn" class="btn btn-primary"><i class="fa-solid fa-paper-plane"></i> إرسال</button>
      </div>

      <!-- مؤشر التحميل -->
      <div id="loading" class="text-center mt-3">
        <div class="spinner-border text-primary" role="status"></div>
      </div>

      <!-- سجل المحادثة -->
      <div id="chatLog" class="chat-log"></div>
    </div>
  </div>

  <script>
    const sendBtn = document.getElementById('sendBtn');
    const userMessage = document.getElementById('userMessage');
    const chatLog = document.getElementById('chatLog');
    const loading = document.getElementById('loading');

    // رسالة ترحيب تلقائية
    window.addEventListener('load', () => {
      const welcome = document.createElement('div');
      welcome.className = 'chat-reply';
      welcome.innerText = 'مرحبًا! كيف يمكنني مساعدتك اليوم؟';
      chatLog.appendChild(welcome);
});

    async function sendMessage() {
      const message = userMessage.value.trim();
      if (!message) return;

      const userBubble = document.createElement('div');
      userBubble.className = 'chat-message';
      userBubble.innerText = message;chatLog.appendChild(userBubble);

      userMessage.value = '';
      sendBtn.disabled = true;
      sendBtn.innerText = '...جاري الإرسال';
      loading.style.display = 'block';

      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json'},
          body: JSON.stringify({ message})
});
        const data = await res.json();

        const replyBubble = document.createElement('div');
        replyBubble.className = 'chat-reply';
        replyBubble.innerText = data.reply || 'لم يتم الحصول على رد.';
        chatLog.appendChild(replyBubble);
} catch (err) {
        const errorBubble = document.createElement('div');
        errorBubble.className = 'chat-reply';
        errorBubble.innerText = 'حدث خطأ أثناء الاتصال بالخادم.';
        chatLog.appendChild(errorBubble);
}

      sendBtn.disabled = false;
      sendBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> إرسال';
      loading.style.display = 'none';
}

    sendBtn.addEventListener('click', sendMessage);

    userMessage.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' &&!e.shiftKey) {
        e.preventDefault();
        sendMessage();
}
});
  </script>
</body>
</html>